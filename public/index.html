<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Esteem Corporation</title>
  <style>
    body { margin: 0; padding-bottom: 3rem; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

    #form { background: rgb(58, 58, 58); padding: 0.25rem; position: fixed; bottom: 0; left: 0; right: 0; display: flex; height: 3rem; box-sizing: border-box; backdrop-filter: blur(10px); }
    #input { border: none; padding: 0 1rem; flex-grow: 1; border-radius: 2rem; margin: 0.25rem; }
    #input:focus { outline-color: black; }
    #submit { background: dodgerblue; border: none; padding: 0 1rem; margin: 0.25rem; border-radius: 10px; outline: none; color: #fff; }
    #dis { background: red; border: none; padding: 0 1rem; margin: 0.25rem; border-radius: 10px; outline: none; color: #fff; }

    #messages { list-style-type: none; margin: 0; padding: 0; }
    #messages > li { padding: 0.5rem 1rem; }
    #messages > li:nth-child(odd) { background: #efefef; }

    a {text-decoration: underline; font-style:bold; font-size: 30px; color: white;}

    #typemessages { padding: 0rem 1rem; }
  </style>
  <meta name="description" content="Esteem Chat">
  <meta name="author" content="Esteem">
  <script src="https://cdn.socket.io/3.1.1/socket.io.min.js"></script>
</head>

<body>
    <div id='chat'>
        <ul id="messages">  </ul>
        <p id='typemessages'></p>
        <form id="form" action="">
        <input id="input" autocomplete="off" placeholder='Message'>
        <button id='submit'>Send</button>
        <button id='dis'>Disconnect</button>
        <a href='http://www.essaytyper.com/' id='bail'>
            BAIL OUT OF CHAT ROOM
        </a>
        </form>
        <script src="/socket.io/socket.io.js"></script>

        <script>
            var name = prompt('What would you like to be called?')
            var socket = io();

            var messages = document.getElementById('messages');
            var form = document.getElementById('form');
            var input = document.getElementById('input');
            var typemessages = document.getElementById('usertyping');
            var bail = document.getElementById('bail');
            var dced = document.getElementById('dis');
            var typemessages = document.getElementById('typemessages');

            input.addEventListener('input', function() {
                socket.emit('type', name);
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (input.value) {
                    socket.emit('chat', { name: name, msg: input.value});
                    socket.emit('stoptype', name);
                    input.value = '';
                }
            });

            bail.addEventListener('click', function() {
                socket.emit('bailed', name);
            });

            dced.addEventListener('click', function() {
                socket.emit('disconnected', name);
                socket.disconnect();
                alert('You have now disconnected from the server, kindly exit out of this tab.')
            });

            socket.on('bailed', function(data) {
                var item = document.createElement('li');
                item.innerHTML = '<em>' + data + ' has bailed from the chat room. R.I.P. </em>';
                messages.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);
            })

            socket.on('chat', function(data) {
                var item = document.createElement('li');
                item.innerHTML = '<strong >' + data.name + '</strong>: ' + data.msg;
                messages.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);
            });

            socket.on('connected', function(data) {
                var item = document.createElement('li');
                item.innerHTML = '<em>' + data + '</em>';
                messages.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);
            })

            socket.on('welcome', function(data) {
                var item = document.createElement('li');
                item.innerHTML = '<strong><em>' + data + '</em></strong>';
                messages.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);
            })

            socket.on('num', function(data) {
                var item = document.createElement('li');
                item.innerHTML = '<em>We now have ' + data + ' clients connected.</em>';
                messages.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);

            });

            socket.on('disconnected', function(data) {
                var item1 = document.createElement('li');
                item1.innerHTML = '<em>' + data.name + '</em>'
                var item2 = document.createElement('li');
                item2.innerHTML = '<em>We now have ' + data.clients + ' clients connected.</em>';
                messages.appendChild(item1);
                messages.appendChild(item2);
                window.scrollTo(0, document.body.scrollHeight);
            })

            socket.on('type', function(data) {
                typemessages.innerHTML='<em>  ' + data + '<em>';
                window.scrollTo(0, document.body.scrollHeight);
            });

            socket.on('stoptype', function(data) {
                typemessages.innerHTML='  ';
                window.scrollTo(0, document.body.scrollHeight)
            });
        </script>
    </div>
</body>
</html>